Overview

The Hodrick–Prescott (HP) filter decomposes a series into trend and cyclical components by penalizing changes in the trend’s second derivative. It is widely used in economics to obtain a smooth long-run trend.

Notes
- The smoothing strength is governed by a lambda parameter internally; higher lambda produces a smoother trend and stronger cycle removal.
- HP can introduce endpoint bias; be cautious interpreting the last observations.

```{r}
# Filter - Hodrick-Prescott

# Install tspredit if needed
install.packages("tspredit")
```

```{r}
# Load packages
library(daltoolbox)
library(tspredit) 
```


```{r}
# Prepare a noisy series example with spikes
data(tsd)
y <- tsd$y
noise <- rnorm(length(y), 0, sd(y)/10)
spike <- rnorm(1, 0, sd(y))
tsd$y <- tsd$y + noise
tsd$y[10] <- tsd$y[10] + spike
tsd$y[20] <- tsd$y[20] + spike
tsd$y[30] <- tsd$y[30] + spike
```

```{r}
library(ggplot2)
# Visualize noisy input
plot_ts(x=tsd$x, y=tsd$y) + theme(text = element_text(size=16))
```

```{r}
# Apply the HP filter (trend extraction)

filter <- ts_fil_hp()             # uses default lambda internally
filter <- fit(filter, tsd$y)
y <- transform(filter, tsd$y)     # returns trend-adjusted output

# Compare original vs trend component (or adjusted)
plot_ts_pred(y=tsd$y, yadj=y) + theme(text = element_text(size=16))
```

