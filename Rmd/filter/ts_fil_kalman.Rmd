Kalman filter: A linear Gaussian state-space model represents the latent state evolution and observations. The Kalman filter recursively computes the optimal (minimum variance) state estimate by alternating prediction and update steps weighted by the Kalman gain. Tuning process/observation noise controls smoothness versus responsiveness.

Objective: Smooth the series using a state-space model with a Kalman Filter, controlling observation noise (H) and process noise (Q).


```{r}
# Filter - Kalman

# Installing the package (if needed)
#install.packages("tspredit")
```

```{r}
# Loading the packages
library(daltoolbox)
library(tspredit) 
```


```{r}
# Series for study with artificial noise and spikes

data(tsd)
y <- tsd$y
noise <- rnorm(length(y), 0, sd(y)/10)
spike <- rnorm(1, 0, sd(y))
tsd$y <- tsd$y + noise
tsd$y[10] <- tsd$y[10] + spike
tsd$y[20] <- tsd$y[20] + spike
tsd$y[30] <- tsd$y[30] + spike
```

```{r}
library(ggplot2)
# Noisy series visualization
plot_ts(x=tsd$x, y=tsd$y) + theme(text = element_text(size=16))
```

```{r}
# Applying the Kalman filter

filter <- ts_fil_kalman(H = 0.1, Q = 1)
filter <- fit(filter, tsd$y)
y <- transform(filter, tsd$y)
plot_ts_pred(y=tsd$y, yadj=y) + theme(text = element_text(size=16))
```

References
- R. E. Kalman (1960). A New Approach to Linear Filtering and Prediction Problems. Journal of Basic Engineering, 82(1), 35â€“45.
